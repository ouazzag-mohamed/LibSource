<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
    <link rel="stylesheet" href="stylebot.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <div class="container">
      <h1><i class="fas fa-robot"></i> Chatbot</h1>
      <div id="pdf-upload">
        <label for="pdf-file"><i class="fas fa-upload"></i> Upload PDF</label>
        <input type="file" id="pdf-file" accept=".pdf" />
      </div>
      <div class="chat-window" id="chat-window"></div>
      <div class="input-area">
        <input type="text" id="user-input" placeholder="Type your message..." />
        <button onclick="sendMessage()">
          <i class="fas fa-paper-plane"></i> Send
        </button>
      </div>
    </div>

    <script>
      // Function to display messages with icons
      function displayMessage(message, messageClass) {
        const chatWindow = document.getElementById("chat-window");

        // Create message container
        const messageContainer = document.createElement("div");
        messageContainer.classList.add("message-container", messageClass);

        // Create an icon for the message
        const icon = document.createElement("i");
        if (messageClass === "bot-message") {
          icon.classList.add("fas", "fa-robot", "message-icon"); // Bot icon
        } else if (messageClass === "user-message") {
          icon.classList.add("fas", "fa-user", "message-icon"); // User icon
        }

        // Create the message text
        const messageElement = document.createElement("div");
        messageElement.classList.add("message");
        messageElement.textContent = message;

        // Append icon and message to the container
        messageContainer.appendChild(icon);
        messageContainer.appendChild(messageElement);

        // Append the container to the chat window
        chatWindow.appendChild(messageContainer);
        chatWindow.scrollTop = chatWindow.scrollHeight; // Auto-scroll to the bottom
      }

      // Function to handle user input and bot response
      function sendMessage() {
        const message = document.getElementById("user-input").value;
        if (message.trim() === "") return; // Prevent empty messages

        displayMessage(message, "user-message"); // Display user message
        document.getElementById("user-input").value = ""; // Clear input

        // Simulate bot response after delay
        setTimeout(() => {
          displayMessage(
            "This is a placeholder bot response. Summarizing PDFs is my specialty!",
            "bot-message"
          );
        }, 500);
      }

      // Function to show bot introduction when the page loads
      function showBotIntroduction() {
        const chatWindow = document.getElementById("chat-window");
        if (chatWindow.children.length === 0) {
          displayMessage(
            "Bonjour ! Je suis votre assistant bot. J'aide les étudiants à résumer des documents PDF et à répondre à leurs questions. Comment puis-je vous aider aujourd'hui ?",
            "bot-message"
          );
        }
      }

      // Trigger bot introduction on page load
      window.addEventListener("DOMContentLoaded", showBotIntroduction);

      // Handle PDF file upload
      document
        .getElementById("pdf-file")
        .addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (file) {
            
          }
        });

      // Function to handle PDF file upload
      document
        .getElementById("pdf-file")
        .addEventListener("change", (event) => {
          const file = event.target.files[0];
          if (file) {
            const formData = new FormData();
            formData.append("file", file);

            displayMessage(
              `PDF uploaded: Processing...`,
              "user-message"
            );

            // Send the file to the backend
            fetch("http://localhost:5000/upload_pdf", {
              method: "POST",
              body: formData,
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.summary) {
                  displayMessage(data.summary, "bot-message");
                } else {
                  displayMessage("Error summarizing PDF.", "bot-message");
                }
              })
              .catch((error) => {
                displayMessage(
                  "Error uploading PDF: " + error.message,
                  "bot-message"
                );
              });
          }
        });
    </script>
  </body>
</html>
